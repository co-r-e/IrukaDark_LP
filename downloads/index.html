<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>IrukaDark — Download for Mac</title>
    <meta name="description" content="Download IrukaDark for macOS (arm64)." />
    <link rel="canonical" href="https://irukadark.com/downloads" />
    <link rel="icon" href="../icons/favicon.svg" type="image/svg+xml" />
    <link rel="icon" href="../icons/icon.png" type="image/png" />
    <link rel="apple-touch-icon" href="../icons/icon.png" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../styles.css" />
    <script>window.DEFAULT_LANG = 'en';</script>
  </head>
  <body>
    <div class="bg fx-grid"></div>
    <div class="bg fx-radial fx-radial-1"></div>
    <div class="bg fx-radial fx-radial-2"></div>
    <div class="bg fx-noise"></div>

    <header class="nav">
      <div class="container">
        <a class="brand" href="/">
          <img src="../icons/logo.svg" alt="IrukaDark" class="brand-logo lg" />
        </a>
        <nav class="nav-actions">
          <div class="lang-dropdown">
            <button class="lang-trigger" id="langTrigger" aria-haspopup="true" aria-expanded="false">
              <svg class="globe-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <circle cx="12" cy="12" r="9"/>
                <path d="M3 12h18"/>
                <path d="M12 3a15 15 0 0 1 0 18"/>
                <path d="M12 3a15 15 0 0 0 0 18"/>
              </svg>
              <span class="lang-text" id="langCode">EN</span>
            </button>
            <div class="lang-menu" id="langMenu">
              <button class="lang-option" data-lang="en">
                <span class="lang-text">English</span>
              </button>
              <button class="lang-option" data-lang="ja">
                <span class="lang-text">日本語</span>
              </button>
            </div>
          </div>
          <a id="download-nav" href="/downloads" class="btn btn-primary" data-i18n="header.clone">Download for Mac</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="container section">
        <div class="section-head">
          <h1 class="section-title">Download IrukaDark for Mac</h1>
          <p class="section-sub">Download the latest macOS installer.</p>
        </div>

        <div class="grid download-cards">
          <article class="card dl-card" data-os="mac">
            <div class="dl-icon" aria-hidden="true"><img class="dl-icon-img" src="../icons/apple.svg" alt="Apple logo" /></div>
            <div>
              <div class="dl-title">macOS</div>
              <div class="dl-sub">macOS 11.0+</div>
              <div class="dl-actions">
                <a id="dl-mac-btn" class="btn btn-primary-white dl-btn" href="https://github.com/co-r-e/IrukaDark/releases/latest">Download for Mac ARM64</a>
              </div>
            </div>
          </article>
          <article class="card dl-card" data-os="github">
            <div class="dl-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path fill="currentColor" d="M12 .297C5.373.297 0 5.67 0 12.297c0 5.302 3.438 9.8 8.205 11.387.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.387-1.333-1.757-1.333-1.757-1.09-.746.083-.73.083-.73 1.205.084 1.84 1.236 1.84 1.236 1.07 1.835 2.807 1.305 3.492.998.108-.776.42-1.305.763-1.605-2.665-.303-5.466-1.332-5.466-5.93 0-1.31.468-2.382 1.235-3.222-.124-.303-.535-1.523.117-3.176 0 0 1.008-.322 3.3 1.23.957-.266 1.984-.399 3.005-.404 1.02.005 2.047.138 3.006.404 2.29-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.873.118 3.176.77.84 1.235 1.912 1.235 3.223 0 4.61-2.803 5.625-5.475 5.921.431.372.815 1.102.815 2.222 0 1.606-.014 2.896-.014 3.286 0 .322.216.694.825.576C20.565 22.092 24 17.592 24 12.297 24 5.67 18.627.297 12 .297z"/>
              </svg>
            </div>
            <div>
              <div class="dl-title">Git Clone</div>
              <div class="dl-sub">Clone the repository locally</div>
              <div class="dl-actions">
                <a class="btn btn-outline dl-btn" href="https://github.com/co-r-e/IrukaDark" target="_blank" rel="noopener">Open Repository</a>
              </div>
            </div>
          </article>
        </div>

        <div style="margin-top:16px;">
          <a class="link" href="https://github.com/co-r-e/IrukaDark/releases" target="_blank" rel="noopener">View the list on GitHub Releases</a>
        </div>

        

        <div class="section" style="margin-top:24px;">
          <h2 class="section-title no-deco" style="font-size:20px;">First‑run notes</h2>
          <div class="grid download-notes">
            <article class="card download-note">
              <div>
                <div class="card-head">
                  <h3 class="card-title">macOS (arm64)</h3>
                </div>
                <p class="card-body">If you see a warning like “can’t be opened” or “from an unidentified developer”, Control‑click the app → Open, then confirm. Or allow it in System Settings → Privacy & Security.</p>
              </div>
            </article>
            <article class="card download-note">
              <div>
                <div class="card-head">
                  <h3 class="card-title">macOS Screenshots</h3>
                </div>
                <p class="card-body">For screenshot analysis, grant Screen Recording when prompted (System Settings → Privacy & Security → Screen Recording).</p>
              </div>
            </article>
          </div>
        </div>
      </section>
    </main>

    <div id="installerNoticeModal" class="modal" role="alertdialog" aria-modal="true" aria-labelledby="installerNoticeTitle" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-header">
          <h3 id="installerNoticeTitle" class="modal-title">Installer Notice</h3>
          <button class="modal-close" type="button" aria-label="Close" data-action="close-notice">×</button>
        </div>
        <div class="modal-body">
          <p>現在はインストーラーを利用してのインストールができません。GitHubよりダウンロードしてご利用ください。</p>
          <div class="cta-actions">
            <a id="installerNoticeLink" class="btn btn-primary" href="https://github.com/co-r-e/IrukaDark" target="_blank" rel="noopener">Open GitHub</a>
            <button type="button" class="btn btn-outline" data-action="close-notice">Close</button>
          </div>
          <p class="muted">GitHubリンク：https://github.com/co-r-e/IrukaDark</p>
        </div>
      </div>
    </div>

    <footer class="container footer">
      <div class="foot-left">
        <span class="muted">© <span id="year"></span> CORe, Inc. All rights reserved.</span>
      </div>
      <div class="foot-right">
        <a class="link" href="https://co-r-e.net" target="_blank" rel="noopener">Company</a>
        <a class="link" href="https://co-r-e.net/contact" target="_blank" rel="noopener">Contact</a>
      </div>
    </footer>

    <script src="../app.js"></script>
    <script>
      (function(){
        const INSTALLER_SUSPENDED = true; // Temporary: disable direct installer download via notice modal
        const REPO = 'co-r-e/IrukaDark';
        const STABLE = { mac: 'IrukaDark-macOS-arm64.dmg' };
        const macBtn = document.getElementById('dl-mac-btn');
        const noticeModal = document.getElementById('installerNoticeModal');
        const noticeLink = document.getElementById('installerNoticeLink');
        const closeNoticeButtons = noticeModal ? noticeModal.querySelectorAll('[data-action="close-notice"]') : [];
        const FOCUSABLE_SELECTOR = 'a[href], button:not([disabled]), [tabindex]:not([tabindex="-1"])';
        let lastFocused = null;

        function pickMacAsset(assets){
          const byName = (re) => assets.find(a => a && a.name && re.test(a.name));
          return byName(/arm64.*\.dmg$/i) || byName(/\.dmg$/i) || byName(/\.pkg$/i) || null;
        }
        function fmtSize(bytes){
          if (!bytes && bytes !== 0) return '';
          const units = ['B','KB','MB','GB'];
          let i=0, n=bytes;
          while(n>=1024 && i<units.length-1){ n/=1024; i++; }
          return n.toFixed(1)+' '+units[i];
        }

        function openNotice(event){
          if (!INSTALLER_SUSPENDED || !noticeModal) return;
          event.preventDefault();
          lastFocused = document.activeElement;
          noticeModal.classList.add('open');
          noticeModal.setAttribute('aria-hidden', 'false');
          const focusTarget = noticeLink || noticeModal.querySelector(FOCUSABLE_SELECTOR);
          if (focusTarget) focusTarget.focus({ preventScroll: true });
          document.addEventListener('keydown', handleKeydown, true);
        }

        function closeNotice(){
          if (!noticeModal) return;
          noticeModal.classList.remove('open');
          noticeModal.setAttribute('aria-hidden', 'true');
          document.removeEventListener('keydown', handleKeydown, true);
          const target = (lastFocused && typeof lastFocused.focus === 'function') ? lastFocused : macBtn;
          if (target) target.focus({ preventScroll: true });
        }

        function handleKeydown(event){
          if (event.key === 'Escape'){
            event.preventDefault();
            closeNotice();
            return;
          }
          if (event.key === 'Tab' && noticeModal && noticeModal.classList.contains('open')){
            const focusable = Array.from(noticeModal.querySelectorAll(FOCUSABLE_SELECTOR));
            if (!focusable.length) return;
            const first = focusable[0];
            const last = focusable[focusable.length - 1];
            if (event.shiftKey && document.activeElement === first){
              event.preventDefault();
              last.focus({ preventScroll: true });
            } else if (!event.shiftKey && document.activeElement === last){
              event.preventDefault();
              first.focus({ preventScroll: true });
            }
          }
        }

        if (noticeModal){
          noticeModal.addEventListener('click', (event) => {
            if (event.target === noticeModal) closeNotice();
          });
          closeNoticeButtons.forEach(btn => btn.addEventListener('click', closeNotice));
        }

        async function run(){
          try { const el = document.querySelector(`.dl-card[data-os="mac"]`); if (el) el.classList.add('active'); } catch(_){}
          try{
            const res = await fetch(`https://api.github.com/repos/${REPO}/releases/latest`, { headers: { 'Accept': 'application/vnd.github+json' } });
            if (!res.ok) throw new Error('GitHub API error');
            const rel = await res.json();
            const assets = Array.isArray(rel.assets) ? rel.assets : [];
            const macAsset = pickMacAsset(assets);
            macBtn.href = macAsset?.browser_download_url || `https://github.com/${REPO}/releases/latest/download/${encodeURIComponent(STABLE.mac)}`;
          }catch(e){
            macBtn.href = `https://github.com/${REPO}/releases/latest/download/${encodeURIComponent(STABLE.mac)}`;
          }

          if (INSTALLER_SUSPENDED && macBtn && !macBtn.dataset.noticeBound){
            macBtn.dataset.originalHref = macBtn.href;
            macBtn.href = 'https://github.com/co-r-e/IrukaDark';
            macBtn.addEventListener('click', openNotice);
            macBtn.dataset.noticeBound = 'true';
          }
        }
        if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', run); else run();
      })();
    </script>
  </body>
  </html>
